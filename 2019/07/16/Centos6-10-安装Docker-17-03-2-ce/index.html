<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Centos6.10 安装Docker 17.03.2-ce · Messay</title><meta name="description" content="Centos6.10 安装Docker 17.03.2-ce - Messay"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://messay.me/atom.xml" title="Messay"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/lovebaicai" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Centos6.10 安装Docker 17.03.2-ce</h1><div class="post-info">Jul 16, 2019</div><div class="post-content"><h4 id="前两天需要在Centos6上面封装docker镜像需要安装docker，但是发现在Centos6上安装docker只能安装docker-1-7-1版本。此版本推送镜像到harbor验证有问题，故需要升级docker版本到17-03-2-ce。"><a href="#前两天需要在Centos6上面封装docker镜像需要安装docker，但是发现在Centos6上安装docker只能安装docker-1-7-1版本。此版本推送镜像到harbor验证有问题，故需要升级docker版本到17-03-2-ce。" class="headerlink" title="前两天需要在Centos6上面封装docker镜像需要安装docker，但是发现在Centos6上安装docker只能安装docker 1.7.1版本。此版本推送镜像到harbor验证有问题，故需要升级docker版本到17.03.2-ce。"></a>前两天需要在Centos6上面封装docker镜像需要安装docker，但是发现在Centos6上安装docker只能安装docker 1.7.1版本。此版本推送镜像到harbor验证有问题，故需要升级docker版本到17.03.2-ce。</h4><div class="tip">特别注意,编译安装过程极度依赖梯子,否则安装很难成功!</div>


<h4 id="一、升级内核"><a href="#一、升级内核" class="headerlink" title="一、升级内核"></a>一、升级内核</h4><ul>
<li>在centos6上安装docker17.03.2，需要先将内核升级到3.10版本(未考证?)，故直接安装最新稳定版内核</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-6-8.el6.elrepo.noarch.rpm</span><br><span class="line">yum install kernel-lt -y</span><br><span class="line">sed -i &apos;s/default=1/default=0/g&apos; /etc/grub.conf</span><br><span class="line">reboot</span><br><span class="line">uname -sr  #Linux 4.4.185-1.el6.elrepo.x86_64</span><br></pre></td></tr></table></figure>
<h4 id="二、安装依赖docker环境"><a href="#二、安装依赖docker环境" class="headerlink" title="二、安装依赖docker环境"></a>二、安装依赖docker环境</h4><ul>
<li>docker 17.03.2安装全部都是在docker里面完成的，故需要安装一个老版本的docker，才能编译安装17.03版本</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 安装1.7.1版本</span><br><span class="line">rpm -ivfh https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm</span><br><span class="line">yum install https://get.docker.com/rpm/1.7.1/centos-6/RPMS/x86_64/docker-engine-1.7.1-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line">docker version # version: 1.7.1</span><br><span class="line"></span><br><span class="line">#下载1.9.1然后替换</span><br><span class="line">curl -sSL -O https://get.docker.com/builds/Linux/x86_64/docker-1.9.1</span><br><span class="line">chmod +x docker-1.9.1</span><br><span class="line">mv docker-1.9.1 /usr/bin/docker</span><br><span class="line"> </span><br><span class="line">service docker restart</span><br><span class="line"></span><br><span class="line">docker version # version: 1.9.1</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="三、安装依赖环境"><a href="#三、安装依赖环境" class="headerlink" title="三、安装依赖环境"></a>三、安装依赖环境</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yum install git make -y</span><br><span class="line"></span><br><span class="line">#Docker使用Golang开发</span><br><span class="line">wget https://dl.google.com/go/go1.10.linux-amd64.tar.gz</span><br><span class="line">tar xzf go1.10.linux-amd64.tar.gz -C /usr/local</span><br><span class="line">mkdir /usr/local/gopackage</span><br><span class="line"> </span><br><span class="line">vi /etc/profile</span><br><span class="line">#在profile中加入下面的环境变量，PATH如果原来就有请自行合并</span><br><span class="line">GOROOT=/usr/local/go</span><br><span class="line">GOPATH=/usr/local/gopackage</span><br><span class="line">PATH=$PATH:$GOROOT/bin:$GOPATH/bin</span><br><span class="line">export GOROOT GOPATH PATH</span><br><span class="line"> </span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<h4 id="四、安装docker"><a href="#四、安装docker" class="headerlink" title="四、安装docker"></a>四、安装docker</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 修改git缓存,防止git clone中断</span><br><span class="line">git config --global http.postBuffer 524288000</span><br><span class="line"></span><br><span class="line">git clone https://github.com/moby/moby</span><br><span class="line">cd moby</span><br><span class="line"></span><br><span class="line"># 选择17.03.2</span><br><span class="line">git checkout v17.03.2-ce</span><br><span class="line"></span><br><span class="line"># 编辑Dockerfile</span><br><span class="line">vim Dockerfile</span><br><span class="line"></span><br><span class="line"># 修改130为:</span><br><span class="line">RUN curl -fsSL &quot;https://golang.org/dl/go$&#123;GO_VERSION&#125;.linux-amd64.tar.gz&quot; \</span><br><span class="line"></span><br><span class="line"># 建议在第一个git clone之前RUN一个代理，否则git clone大概率失败</span><br><span class="line">RUN git config --global http.https://github.com.proxy socks5://127.0.0.1:1080 \</span><br><span class="line"></span><br><span class="line">make build    # 此步骤极度耗时，且因为某种原因，安装过程极易中断</span><br><span class="line">make binary</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h4 id="五、移除旧版本，指向新版本"><a href="#五、移除旧版本，指向新版本" class="headerlink" title="五、移除旧版本，指向新版本"></a>五、移除旧版本，指向新版本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#卸载旧的docker</span><br><span class="line">yum remove docker-engine* -y</span><br><span class="line"></span><br><span class="line">#清理下遗留的文件</span><br><span class="line">rm -rf /var/lib/docker/*</span><br><span class="line"></span><br><span class="line">#docker 配置文件</span><br><span class="line">wget https://raw.githubusercontent.com/moby/moby/master/contrib/init/sysvinit-redhat/docker.sysconfig -O /etc/sysconfig/docker</span><br><span class="line"></span><br><span class="line">#docker init启动文件</span><br><span class="line">wget https://raw.githubusercontent.com/moby/moby/master/contrib/init/sysvinit-redhat/docker -O /etc/init.d/docker</span><br><span class="line"></span><br><span class="line">#修改启动文件中dockerd的位置</span><br><span class="line">sed -i &quot;27s#usr/bin#usr/local/bin#g&quot; /etc/init.d/docker</span><br><span class="line"></span><br><span class="line">#修改环境变量，覆盖functions脚本中的PATH，防止无法找到docker-container等程序</span><br><span class="line">sed -i &quot;23s#functions#functions\nexport PATH=/sbin:/usr/sbin:/bin:/usr/bin:/usr/local/bin#g&quot; /etc/init.d/docker</span><br><span class="line"></span><br><span class="line">#启动</span><br><span class="line">service docker restart</span><br><span class="line"></span><br><span class="line">#查看版本</span><br><span class="line">ln -s /usr/local/bin/docker /usr/bin/docker</span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>
<h4 id="六、完成验证"><a href="#六、完成验证" class="headerlink" title="六、完成验证"></a>六、完成验证</h4><p><img src="https://i.loli.net/2019/07/16/5d2dd9440d37083556.png" alt></p>
<h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><ul>
<li>安装步骤参考：<a href="http://www.senra.me/install-latest-docker-1703-ce-for-centos6/" target="_blank" rel="noopener">CentOS6 安装最新版Docker 17.03——自给自足，老树逢春
</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2019/07/20/搭建DNS管理平台的一些注意要点/" class="prev">上一篇</a><a href="/2019/07/14/DNS各类型互斥关系说明/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2020 <a href="http://messay.me">Messay</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>